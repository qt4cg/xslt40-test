<?xml version="1.0" encoding="UTF-8"?>
<test-set xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns="http://www.w3.org/2012/10/xslt-test-catalog" name="xsl-record" covers-40="PR1858">
    <description>Tests xsl:record</description>
    <dependencies>
        <spec value="XSLT40+"/>
    </dependencies>

    <test-case name="xsl-record-001">
        <description>Basic test of xsl:record in an XSLT 4.0 context</description>
        <created by="John Lumley" on="2025-04-07"/>
        <test>
            <stylesheet file="xsl-record-001.xsl"/>
            <initial-template name="main"/>
        </test>
        <result>
            <assert>/json='[{"CA":[{"kitchen":{"broiler":20,"toaster":150}},{"clothes":{"socks":510}}]},{"MA":[{"kitchen":{"blender":250,"toaster":50}},{"clothes":{"shirt":10}}]}]'</assert>
        </result>
    </test-case>

    <test-case name="xsl-record-002">
        <description>Test of XSLT 4.0 xsl:record/xsl:map-entry combination</description>
        <created by="John Lumley" on="2025-04-07"/>
        <test>
            <stylesheet file="xsl-record-002.xsl"/>
            <initial-template name="main"/>
        </test>
        <result>
            <assert>/json='[{"CA":[{"kitchen":{"broiler":20,"toaster":150}},{"clothes":{"socks":510}}]},{"MA":[{"kitchen":{"blender":250,"toaster":50}},{"clothes":{"shirt":10}}]}]'</assert>
        </result>
    </test-case>


    <test-case name="xsl-record-003">
        <description>Error if xsl:record used in the content of an element constructor</description>
        <created by="John Lumley" on="2025-04-08"/>
        <test>
            <stylesheet file="xsl-record-003.xsl"/>
            <initial-template name="main"/>
        </test>
        <result>
            <error code="XTDE0450"/>
        </result>
    </test-case>

    <test-case name="xsl-record-004">
        <description>Error if a non-map used in the content of xsl:record</description>
        <created by="John Lumley" on="2025-04-08"/>
        <test>
            <stylesheet file="xsl-record-004.xsl"/>
            <initial-template name="main"/>
        </test>
        <result>
            <error code="XTTE3375"/>
        </result>
    </test-case>

    <test-case name="xsl-record-005">
        <description>Test for an 'empty' xsl:record</description>
        <created by="John Lumley" on="2025-04-18"/>
        <test>
            <stylesheet file="xsl-record-005.xsl"/>
            <initial-template name="main"/>
        </test>
        <result>
            <assert>/out/@size = '0'</assert>
        </result>
    </test-case>

    <test-case name="xsl-record-006">
        <description>Test unprefixed standard attributes on xsl:record</description>
        <created by="John Lumley" on="2025-04-18"/>
        <test>
            <stylesheet file="xsl-record-006.xsl"/>
            <initial-template name="main"/>
        </test>
        <result>
            <assert>/json='{"data":"Some data","default-collation":"http://www.w3.org/2005/xpath-functions/collation/codepoint","default-mode":"b","default-validation":"preserve","exclude-result-prefixes":"c d e","expand-text":true,"expression":"{3+5}","extension-element-prefixes":"f g h","schema-role":"output","use-when":true,"version":3.1,"xpath-default-namespace":"b"}'</assert>
        </result>
    </test-case>

    <test-case name="xsl-record-007">
        <description>Test xsl prefixed standard attributes on xsl:record</description>
        <created by="John Lumley" on="2025-04-18"/>
        <test>
            <stylesheet file="xsl-record-007.xsl"/>
            <initial-template name="main"/>
        </test>
        <result>
            <assert>/json='[{"data":"Some data","expression":"8"}]'</assert>
        </result>
    </test-case>

    <test-case name="xsl-record-008">
        <description>Potential shadow attributes ignored on xsl:record</description>
        <created by="John Lumley" on="2025-04-18"/>
        <test>
            <stylesheet file="xsl-record-008.xsl"/>
            <initial-template name="main"/>
        </test>
        <result>
            <all-of>
                <assert>/out/@a = 'red'</assert>
                <assert>/out/@b = 'underscored'</assert>
            </all-of>
        </result>
    </test-case>


    <test-case name="xsl-record-401">
        <description>xsl:record with @duplicates (select first)</description>
        <created by="John Lumley" on="2025-04-18"/>
        <dependencies>
            <spec value="XSLT40+"/>
        </dependencies>
        <test>
            <stylesheet file="xsl-record-401.xsl"/>
        </test>
        <result>
            <assert>/out/@result = '1'</assert>
        </result>
    </test-case>

    <test-case name="xsl-record-402">
        <description>xsl:record with @duplicates (select last)</description>
        <created by="John Lumley" on="2025-04-18"/>
        <dependencies>
            <spec value="XSLT40+"/>
        </dependencies>
        <test>
            <stylesheet file="xsl-record-402.xsl"/>
        </test>
        <result>
            <assert>/out/@result = '5'</assert>
        </result>
    </test-case>

    <test-case name="xsl-record-403">
        <description>xsl:record with @duplicates (select sequence concatenation)</description>
        <created by="John Lumley" on="2025-04-18"/>
        <dependencies>
            <spec value="XSLT40+"/>
        </dependencies>
        <test>
            <stylesheet file="xsl-record-403.xsl"/>
        </test>
        <result>
            <assert>/out/@result = '1 4 5'</assert>
        </result>
    </test-case>

    <test-case name="xsl-record-404">
        <description>xsl:record with on-duplicates (select string-join)</description>
        <created by="John Lumley" on="2025-04-18"/>
        <dependencies>
            <spec value="XSLT40+"/>
        </dependencies>
        <test>
            <stylesheet file="xsl-record-404.xsl"/>
        </test>
        <result>
            <assert>/out/@result = '1-4-5'</assert>
        </result>
    </test-case>

    <test-case name="xsl-record-405">
        <description>xsl:record with on-duplicates (select error())</description>
        <created by="John Lumley" on="2025-04-18"/>
        <dependencies>
            <spec value="XSLT40+"/>
        </dependencies>
        <test>
            <stylesheet file="xsl-record-405.xsl"/>
        </test>
        <result>
            <error code="Q{http://example.com/}dupe"/>
        </result>
    </test-case>

    <test-case name="xsl-record-407" covers-40="PR1740">
        <description>xsl:record with @duplicates (select first)</description>
        <created by="John Lumley" on="2025-04-18"/>
        <dependencies>
            <spec value="XSLT40+"/>
        </dependencies>
        <test>
            <stylesheet file="xsl-record-407.xsl"/>
        </test>
        <result>
            <assert>/out/@result = '1'</assert>
        </result>
    </test-case>

    <test-case name="xsl-record-408" covers-40="PR1740">
        <description>xsl:record with @duplicates (select last)</description>
        <created by="John Lumley" on="2025-04-18"/>
        <dependencies>
            <spec value="XSLT40+"/>
        </dependencies>
        <test>
            <stylesheet file="xsl-record-408.xsl"/>
        </test>
        <result>
            <assert>/out/@result = '5'</assert>
        </result>
    </test-case>

    <test-case name="xsl-record-409" covers-40="PR1740">
        <description>xsl:record with duplicates=combine</description>
        <created by="John Lumley" on="2025-04-18"/>
        <dependencies>
            <spec value="XSLT40+"/>
        </dependencies>
        <test>
            <stylesheet file="xsl-record-409.xsl"/>
        </test>
        <result>
            <assert>/out/@result = '1 4 5'</assert>
        </result>
    </test-case>

    <test-case name="xsl-record-410" covers-40="PR1740">
        <description>xsl:record with duplicates=reject</description>
        <created by="John Lumley" on="2025-04-18"/>
        <dependencies>
            <spec value="XSLT40+"/>
        </dependencies>
        <test>
            <stylesheet file="xsl-record-410.xsl"/>
        </test>
        <result>
            <error code="Q{http://example.com/}dupe"/>
        </result>
    </test-case>


</test-set>
